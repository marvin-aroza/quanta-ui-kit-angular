# .github/workflows/sync-from-gitlab.yml

name: Sync from GitLab

on:
  # Run the workflow twice a day (at 00:00 and 12:00 UTC)
  schedule:
    - cron: '0 0,12 * * *'
  
  # Allow running this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git repository
        env:
          # The GITHUB_TOKEN is a secret automatically provided by GitHub
          # to authenticate in the repository where the workflow is running.
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
          # This is the GitLab Personal Access Token you created and stored
          # in GitHub secrets.
          GITLAB_PAT: ${{ secrets.GITLAB_PAT }}
        run: |
          # Replace with your GitLab repository URL
          GITLAB_REPO_URL="https://gitlab.com/eden7544645/angular/quanta-ui-kit-angular.git"

          # Construct the authenticated GitHub repository URL
          # This uses the GITHUB_TOKEN for authentication.
          GITHUB_REPO_URL="https://${{ github.actor }}:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git"

          # Create a bare clone of the GitLab repository using the GitLab PAT
          git clone --bare "https://oauth2:${GITLAB_PAT}@${GITLAB_REPO_URL#https://}" gitlab-mirror
          
          cd gitlab-mirror
          
          # Set the push URL to the authenticated GitHub repository URL
          git remote set-url --push origin "${GITHUB_REPO_URL}"
          
          # Push all branches and tags from GitLab to GitHub
          git push --mirror origin

      - name: Verify push
        run: echo "Successfully synced from GitLab to GitHub."
